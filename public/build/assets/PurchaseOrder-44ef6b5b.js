import{r as i,j as c,a}from"./app-e057de79.js";import{D as ke,d as Ie,N as Ae,c as Me}from"./index-92f9eb90.js";import{E as Pe}from"./exceljs.min-9c74167d.js";import{TextFilter as f}from"./TextFilter-0e8f9a4a.js";import Fe from"./MainTable-0acebb6e.js";import K from"./InvoicesButton-7ea88f0c.js";import{S as Y}from"./react-select.esm-e6119c41.js";import{m as $}from"./moment-80f1d0fa.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./react-paginate-61d0e15f.js";import"./index-e929b1ea.js";import"./NotFound-19253a0b.js";import"./moment-fbc5633a.js";import"./assertThisInitialized-9eca4e7a.js";import"./emotion-react.browser.esm-ebc793e1.js";import"./emotion-memoize.esm-f5713a00.js";import"./hoist-non-react-statics.cjs-8f2ef505.js";function Ue({setActiveIndexInv:E,POs:p,states:v,setPO:_,supplierData:x,companies:y,setPOBack:q,categories:w,setPODetails:G,currentUser:m,loadingPOs:Q}){function C(e){return!e||e.length===0?[]:m.role_id==6||m.role_id==7?e.filter(l=>l.StateId===m.state):e}const[A,N]=i.useState(C(p)),[R,Ye]=i.useState(A),[X,L]=i.useState(0),[D,Z]=i.useState(0),[M,j]=i.useState([]),[U,ee]=i.useState([]),[P,te]=i.useState(),[ae,Ee]=i.useState(),[le,_e]=i.useState(),[oe,Re]=i.useState(),[W,ne]=i.useState([]),[B,re]=i.useState([]),[z,se]=i.useState([]),[b,ie]=i.useState(H(p)),[k,de]=i.useState(J(p));i.useEffect(()=>{N(R)},[R]);const F={control:e=>({...e,minHeight:"unset",height:"auto"}),option:(e,l)=>({...e,color:"black"}),multiValue:e=>({...e,overflow:"hidden"}),valueContainer:e=>({...e,width:"400px",maxHeight:"500px",overflow:"auto"}),inputContainer:e=>({...e,height:"100px"}),multiValueLabel:e=>({...e,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:"12px"})};function H(e){var u;let l=[];Array.isArray(e)&&(l=e.filter(t=>T(t==null?void 0:t.PoDate)));const o=l.sort((t,n)=>new Date(t.PoDate)-new Date(n.PoDate));return o.length===0?null:new Date((u=o[0])==null?void 0:u.PoDate).toLocaleDateString("en-CA")}function T(e){const l=new Date(e);return!isNaN(l)}function J(e){var u;let l=[];Array.isArray(e)&&(l=e.filter(t=>T(t==null?void 0:t.PoDate)));const o=l.sort((t,n)=>new Date(n.PoDate)-new Date(t.PoDate));return o.length===0?null:new Date((u=o[0])==null?void 0:u.PoDate).toLocaleDateString("en-CA")}i.useEffect(()=>{N(C(p))},[p]),i.useEffect(()=>{N(V(C(p))),ee(V(C(p)))},[p,D,b,k,P,W,B,z]);const[O,ce]=i.useState([{id:0,name:"All",icon:ke,current:!0},{id:1,name:"Waiting approval",icon:Ie,current:!1},{id:2,name:"Rejected",icon:Ae,current:!1},{id:3,name:"Closed",icon:Me,current:!1}]),V=e=>{L(0);let l=Array.isArray(e)?e.filter(t=>D==1?m.role_id==6||m.role_id==7?t.ApprovalStatus==1:t.SecondApproval==1:D==2?m.role_id==6||m.role_id==7?t.ApprovalStatus==3:t.SecondApproval==3:D==3?t.MatchInvoice==3:D==0):[];(m.role_id==6||m.role_id==7)&&(l=l.filter(t=>t.StateId==m.state));const o=W.map(t=>t.value),h=B.map(t=>t.value),u=z.map(t=>t.value);return l=l.filter(t=>{const n=o.length===0||(o==null?void 0:o.includes(t.StateId)),r=P?t.PoNo.toLowerCase().includes(P.toLowerCase()):!0,S=h.length===0||(h==null?void 0:h.includes(t.SupplierId)),s=u.length===0||(u==null?void 0:u.includes(t.CompanyId)),d=new Date(t.PoDate),g=new Date(b),I=new Date(k);return g.setHours(0),I.setSeconds(59),I.setMinutes(59),I.setHours(23),d>=g&&d<=I&&r&&n&&S&&s}),l};function ue(e){Z(e);const l=O.map(o=>o.id===e?{...o,current:!0}:{...o,current:!1});ce(l)}function pe(){_(null),E(8)}const me=e=>e.map(o=>({value:o.StateId,label:o.StateCode})),fe=e=>e.map(o=>({value:o.CompanyId,label:o.CompanyName})),he=e=>e.map(o=>({value:o.SupplierId,label:o.SupplierName})),ge=[{key:"PoNo",label:"Po No",Filter:f},{key:"StateId",label:"State",Filter:f},{key:"SupplierId",label:"Supplier",Filter:f},{key:"CompanyId",label:"Company",Filter:f},{key:"CategoryId",label:"Category",Filter:f},{key:"PoDate",label:"Po Date",Filter:f},{key:"Amount",label:"Amount",Filter:f},{key:"ApprovalStatus",label:"Approval Status",Filter:f},{key:"SecondApproval",label:"Second Approval",Filter:f},{key:"Description",label:"Description",Filter:f},{key:"MatchInvoice",label:"Match Invoice",Filter:f}],Se=e=>{const l=e.target.value;ie(l)},ve=e=>{const l=e.target.value;de(l)},xe=e=>{ne(e)},ye=e=>{re(e)},De=e=>{se(e)};function we(e){te(e.target.value)}function Ce(){return!(m.role_id==8||m.role_id==10)}const Ne=["Po No","State","Supplier","Company","Category","Po Date","Amount","Approval Status","Second Approval","Description","Match Invoice"];function be(){let e=Ne;const l=M.map(n=>e.reduce((r,S)=>{const s=S.replace(/\s+/g,"");if(s)if(S.replace(/\s+/g,"")==="PoDate")r[S.replace(/\s+/g,"")]=$(n.PoDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY")=="Invalid date"?"":$(n.PoDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY");else if(s==="ApprovalStatus")n.ApprovalStatus==1?r[s]="Waiting":n.ApprovalStatus==2?r[s]="Approved":r[s]="Rejected";else if(s==="SecondApproval")n.SecondApproval==1?r[s]="Waiting":n.SecondApproval==2?r[s]="Approved":r[s]="Rejected";else if(s==="MatchInvoice")n.MatchInvoice==1?r[s]="Waiting":n.MatchInvoice==2?r[s]="Match":r[s]="Closed";else if(s==="State"){const d=v==null?void 0:v.find(g=>g.StateId===n.StateId);r[s]=d==null?void 0:d.StateCode}else if(s==="Supplier"){const d=x==null?void 0:x.find(g=>g.SupplierId===n.SupplierId);r[s]=d==null?void 0:d.SupplierName}else if(s==="Company"){const d=y==null?void 0:y.find(g=>g.CompanyId===n.CompanyId);r[s]=d==null?void 0:d.CompanyName}else if(s==="Category"){const d=w==null?void 0:w.find(g=>g.CategoryId===n.CategoryId);r[s]=d==null?void 0:d.CategoryName}else r[S.replace(/\s+/g,"")]=n[S.replace(/\s+/g,"")];return r},{})),o=new Pe.Workbook,h=o.addWorksheet("Sheet1"),u=h.addRow(e);u.font={bold:!0},u.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE2B540"}},u.alignment={horizontal:"center"},l.forEach(n=>{h.addRow(Object.values(n)).eachCell(S=>{S.alignment={horizontal:"left"}})});const t=e.map(()=>15);h.columns=t.map((n,r)=>({width:n,key:e[r]})),o.xlsx.writeBuffer().then(n=>{const r=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});saveAs(r,"Purchase orders.xlsx")})}return c("div",{className:"p-5 bg-smooth",children:[c("div",{className:"flex gap-x-1 items-center",children:[a("h1",{className:"font-bold text-dark text-3xl",children:"Purchase Order"})," ",c("p",{className:"mt-auto text-gray-400",children:["(",p==null?void 0:p.length,")"]}),c("div",{className:" ml-auto flex gap-x-2",children:[M.length>0?a("div",{className:" ",children:a(K,{name:"Export",onClick:()=>be(),className:"w-auto ml-auto"})}):null,Ce()?a("div",{className:"hidden sm:block",children:a(K,{name:"Create PO",onClick:()=>pe(),className:"w-auto ml-auto "})}):null]})]}),c("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-3 gap-y-3 mt-5",children:[a("div",{children:c("div",{className:"relative border rounded",children:[a("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute top-0 bottom-0 w-4 h-4 my-auto text-gray-400 left-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a("input",{type:"text",placeholder:"Po No",onChange:we,className:"w-full py-0.5 h-[35px] pl-12 pr-4 text-gray-500 border-none rounded-md outline-none "})]})}),a("div",{className:"col-span-1",children:c("div",{className:"flex lg:items-center flex-col md:flex-row",children:[a("input",{value:b,min:H(p),max:k,type:"date",name:"to-date",id:"to-date",onChange:Se,className:"block w-full md:max-w-lg h-[35px]  rounded-md border-0 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"}),a("div",{className:"px-2 ",children:"to"}),a("input",{min:b,max:J(p),value:k,onChange:ve,type:"date",name:"to-date",id:"to-date",className:"block w-full md:max-w-lg h-[35px]  rounded-md border-0 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"})]})})]}),c("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-3 gap-y-3 mt-5",children:[a("div",{children:a("div",{className:"mt-2 w-full sm:mt-0 ",children:a(Y,{placeholder:a("div",{children:"State... "}),styles:F,isMulti:!0,name:"colors",value:ae,isSearchable:!1,options:me(v),onChange:xe,className:"basic-multi-select text-red ",classNamePrefix:"select"})})}),c("div",{children:[" ",a("div",{className:"mt-2 w-full sm:mt-0 ",children:a(Y,{placeholder:a("div",{children:"Supplier... "}),styles:F,isMulti:!0,name:"colors",value:le,isSearchable:!1,options:he(x),onChange:ye,className:"basic-multi-select text-red ",classNamePrefix:"select"})})]}),c("div",{children:[" ",a("div",{className:"mt-2 w-full sm:mt-0 ",children:a(Y,{placeholder:a("div",{children:"Company... "}),styles:F,isMulti:!0,name:"colors",value:oe,isSearchable:!1,options:fe(y),onChange:De,className:"basic-multi-select text-red ",classNamePrefix:"select"})})]})]}),a("ul",{className:"flex space-x-2 mt-5 border-b",children:O.map((e,l)=>c("li",{className:`cursor-pointer text-xs flex flex-row sm:text-base py-2 ${e.current===!0?"text-dark border-b-4  border-goldd font-bold ":"text-gray-400 "}`,onClick:()=>ue(e.id),children:[a(e.icon,{className:"w-5 hidden sm:block"}),c("div",{className:"px-2",children:[" ",e.name]})]},l))}),Q?c("div",{className:"min-h-screen md:pl-20 pt-16 h-full flex flex-col items-center justify-center",children:[c("div",{className:"flex items-center justify-center",children:[a("div",{className:"h-5 w-5 bg-goldd rounded-full mr-5 animate-bounce"}),a("div",{className:"h-5 w-5 bg-goldd rounded-full mr-5 animate-bounce200"}),a("div",{className:"h-5 w-5 bg-goldd rounded-full animate-bounce400"})]}),a("div",{className:"text-dark mt-4 font-bold",children:"Please wait while we get the data for you."})]}):c("div",{children:[" ",a(Fe,{originalData:U,sortedData:A,setSortedData:N,header:ge,body:A,states:v,setPO:_,selectedRecords:M,setSelectedRecords:j,supplierData:x,companies:y,categories:w,currentPage:X,setCurrentPage:L,setPOBack:q,setPODetails:G,setActiveIndexInv:E,currentUser:m})]})]})}export{Ue as default};
