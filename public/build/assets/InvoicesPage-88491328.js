import{r as i,j as m,a as n}from"./app-e057de79.js";import{b as Ee}from"./index-2fd36de9.js";import{D as Oe,d as Be,e as Re,f as _e}from"./index-92f9eb90.js";import{E as Le}from"./exceljs.min-9c74167d.js";import{TextFilter as c}from"./TextFilter-0e8f9a4a.js";import We from"./MainTable-0acebb6e.js";import Q from"./InvoicesButton-7ea88f0c.js";import{S as T}from"./react-select.esm-e6119c41.js";import{m as v}from"./moment-80f1d0fa.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./react-paginate-61d0e15f.js";import"./index-e929b1ea.js";import"./NotFound-19253a0b.js";import"./moment-fbc5633a.js";import"./assertThisInitialized-9eca4e7a.js";import"./emotion-react.browser.esm-ebc793e1.js";import"./emotion-memoize.esm-f5713a00.js";import"./hoist-non-react-statics.cjs-8f2ef505.js";function dt({setActiveIndexInv:E,invoices:g,states:D,supplierData:x,companies:I,AlertToast:O,setPODetails:X,POs:Z,setPOBack:U,url:j,getInvoices:ee,categories:N,setInvoice:B,currentUser:f,setLoadingInvoices:He,loadingInvoices:R,setInvoiceDetails:te}){function A(e){return!e||e.length===0?[]:f.role_id==6||f.role_id==7?e.filter(t=>t.StateId===f.state):e}const[b,M]=i.useState(A(g)),[S,ae]=i.useState(0),[le,_]=i.useState(0),[C,w]=i.useState([]),[ne,re]=i.useState([]),[L,oe]=i.useState(b),[F,se]=i.useState(),[ie,qe]=i.useState(),[de,ze]=i.useState(),[ce,Je]=i.useState(),[W,ue]=i.useState([]),[H,me]=i.useState([]),[q,pe]=i.useState([]),[Y,fe]=i.useState(z(g)),[k,he]=i.useState(V(g));i.useEffect(()=>{oe(b)},[b]),i.useEffect(()=>{M($(A(g))),re($(A(g)))},[g,R,S,Y,k,F,W,H,q]);function z(e){var p;let t=[];Array.isArray(e)&&(t=e.filter(l=>J(l==null?void 0:l.InvoiceDate)));const a=t.sort((l,r)=>new Date(l.InvoiceDate)-new Date(r.InvoiceDate));return a.length===0?null:new Date((p=a[0])==null?void 0:p.InvoiceDate).toLocaleDateString("en-CA")}function J(e){const t=new Date(e);return!isNaN(t)}function V(e){var p;let t=[];Array.isArray(e)&&(t=e.filter(l=>J(l==null?void 0:l.InvoiceDate)));const a=t.sort((l,r)=>new Date(r.InvoiceDate)-new Date(l.InvoiceDate));return a.length===0?null:new Date((p=a[0])==null?void 0:p.InvoiceDate).toLocaleDateString("en-CA")}const $=e=>{w([]);let t;t=Array.isArray(e)?e.filter(l=>S==1?f.role_id==6||f.role_id==7?l.ApprovalStatus==1&&l.SecondApproval==1:l.SecondApproval==1:S==2?l.PaymentStatus===!1&&l.SecondApproval==2:S==3?l.PaymentStatus===!0:S==0):[];const a=W.map(l=>l.value),u=H.map(l=>l.value),p=q.map(l=>l.value);return t=t.filter(l=>{const r=a.length===0||(a==null?void 0:a.includes(l.StateId)),o=F?l.InvoiceNo.toLowerCase().includes(F.toLowerCase()):!0,h=u.length===0||(u==null?void 0:u.includes(l.SupplierId)),s=p.length===0||(p==null?void 0:p.includes(l.CompanyId)),d=new Date(l.InvoiceDate),y=new Date(Y),P=new Date(k);y.setHours(0),P.setSeconds(59),P.setMinutes(59),P.setHours(23);const K=f.state==l.StateId;return d>=y&&d<=P&&o&&r&&h&&s&&(K||!K&&r)}),t},ge=e=>{const t=e.target.value;fe(t)},ye=e=>{const t=e.target.value;he(t)};function Se(e){se(e.target.value)}function ve(){return f.role_id==6||f.role_id==7}const[G,De]=i.useState([{id:0,name:"Invoices",icon:Oe,current:!0,role:["1","6","7","8","9","10"]},{id:1,name:"Waiting Approval",icon:Be,current:!1,role:["1","6","7","8","9","10"]},{id:2,name:"Bills",icon:Re,current:!1,role:["1","8","9","10"]},{id:3,name:"Paid Invoices",icon:Ee,current:!1,role:["1","6","7","8","9","10"]}]),xe=[{key:"InvoiceNo",label:"Invoice No",Filter:c},{key:"PoNb",label:"Po No",Filter:c},{key:"StateId",label:"State",Filter:c},{key:"SupplierId",label:"Supplier",Filter:c},{key:"CompanyId",label:"Company",Filter:c},{key:"CategoryId",label:"Category",Filter:c},{key:"InvoiceDate",label:"Invoice Date",Filter:c},{key:"DueDate",label:"Due Date",Filter:c},{key:"Amount",label:"Amount",Filter:c},{key:"PaymentTypeId",label:"Payment Type",Filter:c},{key:"ProcessedBank",label:"Processed Bank",Filter:c},{key:"PaymentDate",label:"Payment Date",Filter:c},{key:"ApprovalStatus",label:"Approval Status",Filter:c},{key:"SecondApproval",label:"Second Approval",Filter:c},{key:"PaymentStatus",label:"Payment Status",Filter:c},{key:"PodRequired",label:"Pod Required",Filter:c},{key:"Description",label:"Description",Filter:c}];function Ie(e){_(0),w([]),ae(e);const t=G.filter(a=>a.role.includes(f.role_id)).map(a=>a.id===e?{...a,current:!0}:{...a,current:!1});De(t)}function be(){B(null),E(7)}const Ce=e=>{const t=e.map(a=>({value:a.StateId,label:a.StateCode}));return t.sort((a,u)=>a.label.localeCompare(u.label)),t},Ne=e=>{const t=e.map(a=>({value:a.CompanyId,label:a.CompanyName}));return t.sort((a,u)=>a.label.localeCompare(u.label)),t},we=e=>{const t=e.map(a=>({value:a.SupplierId,label:a.SupplierName}));return t.sort((a,u)=>a.label.localeCompare(u.label)),t},Ye=e=>{ue(e)},ke=e=>{me(e)},Pe=e=>{pe(e)};function Ae(){let e=C.filter(t=>t.SecondApproval==2).map(t=>({InvoiceId:t.InvoiceId}));axios.post(`${j}api/GTIS/PayInvoice`,e,{headers:{UserId:f.user_id,Payment_Status:1}}).then(t=>{O("Paid Successfully",1),w([]),ee()}).catch(t=>{O("Error please try again.",2),console.log(t)})}function Me(){return f.role_id!=10}const Fe=["Invoice No","Po Nb","State","Supplier","Company","Category","Invoice Date","Due Date","Amount","Payment Type","Processed Bank","Payment Date","Approval Status","Second Approval","Payment Status","Pod Required","Description"];function Te(){let e=Fe;const t=C.map(r=>e.reduce((o,h)=>{const s=h.replace(/\s+/g,"");if(s)if(h.replace(/\s+/g,"")==="InvoiceDate")o[h.replace(/\s+/g,"")]=v(r.InvoiceDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY")=="Invalid date"?"":v(r.InvoiceDate.replace("T"," "),"YYYY-MM-DD HH:mm:ss").format("DD-MM-YYYY");else if(h.replace(/\s+/g,"")==="DueDate")o[h.replace(/\s+/g,"")]=v(r.DueDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY hh:mm A")=="Invalid date"?"":v(r.DueDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY");else if(h.replace(/\s+/g,"")==="PaymentDate")o[h.replace(/\s+/g,"")]=v(r.PaymentDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY")=="Invalid date"?"":v(r.PaymentDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY");else if(s==="ApprovalStatus")r.ApprovalStatus==1?o[s]="Waiting":r.ApprovalStatus==2?o[s]="Approved":o[s]="Rejected";else if(s==="PaymentStatus")r.PaymentStatus==!0?o[s]="Paid":o[s]="Not paid";else if(s==="SecondApproval")r.SecondApproval==1?o[s]="Waiting":r.SecondApproval==2?o[s]="Approved":o[s]="Rejected";else if(s==="PaymentType")r.PaymentTypeId==1?o[s]="Credit card":r.PaymentTypeId==2&&(o[s]="Cash");else if(s==="State"){const d=D==null?void 0:D.find(y=>y.StateId===r.StateId);o[s]=d==null?void 0:d.StateCode}else if(s==="Supplier"){const d=x==null?void 0:x.find(y=>y.SupplierId===r.SupplierId);o[s]=d==null?void 0:d.SupplierName}else if(s==="Company"){const d=I==null?void 0:I.find(y=>y.CompanyId===r.CompanyId);o[s]=d==null?void 0:d.CompanyName}else if(s==="Category"){const d=N==null?void 0:N.find(y=>y.CategoryId===r.CategoryId);o[s]=d==null?void 0:d.CategoryName}else o[h.replace(/\s+/g,"")]=r[h.replace(/\s+/g,"")];return o},{})),a=new Le.Workbook,u=a.addWorksheet("Sheet1"),p=u.addRow(e);p.font={bold:!0},p.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE2B540"}},p.alignment={horizontal:"center"},t.forEach(r=>{u.addRow(Object.values(r)).eachCell(h=>{h.alignment={horizontal:"left"}})});const l=e.map(()=>15);u.columns=l.map((r,o)=>({width:r,key:e[o]})),a.xlsx.writeBuffer().then(r=>{const o=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});saveAs(o,"Invoices.xlsx")})}return i.useEffect(()=>{M(L)},[L]),m("div",{className:"p-5 bg-smooth",children:[m("div",{className:"flex gap-x-1 items-center",children:[n("h1",{className:"font-bold text-dark text-3xl",children:"Invoices"})," ",m("p",{className:"mt-auto text-gray-400",children:["(",g==null?void 0:g.length,")"]}),m("div",{className:" ml-auto flex gap-x-2",children:[C.length>0&&S==2?m("button",{type:"button",className:"inline-flex items-center justify-center w-[5.5rem] h-[27px] rounded-md border border-transparent bg-goldd px-3 py-2 text-xs font-medium leading-4 text-dark shadow-sm hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-goldt focus:ring-offset-2",onClick:Ae,children:[n(_e,{className:"h-5 mr-2"}),n("span",{children:"Pay"})]}):null,C.length>0?n("div",{className:" ",children:n(Q,{name:"Export",onClick:()=>Te(),className:"w-auto ml-auto"})}):null,Me()?n("div",{className:"hidden sm:block",children:n(Q,{name:"Create invoice",onClick:()=>be(),className:"w-auto ml-auto"})}):null]})]}),m("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-3 gap-y-3 mt-5",children:[n("div",{children:m("div",{className:"relative border rounded",children:[n("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute top-0 bottom-0 w-4 h-4 my-auto text-gray-400 left-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:n("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),n("input",{type:"text",placeholder:"Invoice No",onChange:Se,className:"w-full py-0.5 h-[35px] pl-12 pr-4 text-gray-500 border-none rounded-md outline-none "})]})}),n("div",{className:"col-span-1 ",children:m("div",{className:"flex lg:items-center flex-col md:flex-row",children:[n("input",{value:Y,min:z(g),max:k,type:"date",name:"to-date",id:"to-date",onChange:ge,className:"block w-full max-w-lg h-[35px]  rounded-md border-0 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"}),n("div",{className:"px-2",children:"to"}),n("input",{min:Y,max:V(g),value:k,onChange:ye,type:"date",name:"to-date",id:"to-date",className:"block w-full max-w-lg h-[35px]  rounded-md border-0 py-1.5 text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6"})]})})]}),m("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-3 gap-y-3 mt-5",children:[ve()?null:n("div",{children:n("div",{className:"mt-2 w-full sm:mt-0 ",children:n(T,{placeholder:n("div",{children:"State... "}),isMulti:!0,name:"colors",value:ie,isClearable:!0,isSearchable:!0,options:Ce(D),onChange:Ye,className:"basic-multi-select text-red",classNamePrefix:"select",id:"stateSelect"})})}),m("div",{children:[" ",n("div",{className:"mt-2 w-full sm:mt-0 ",children:n(T,{placeholder:n("div",{children:"Supplier... "}),isMulti:!0,name:"colors",value:de,isClearable:!0,isSearchable:!0,options:we(x),onChange:ke,className:"basic-multi-select text-red ",classNamePrefix:"select"})})]}),m("div",{children:[" ",n("div",{className:"mt-2 w-full sm:mt-0 ",children:n(T,{placeholder:n("div",{children:"Company... "}),isMulti:!0,name:"colors",value:ce,isClearable:!0,isSearchable:!0,options:Ne(I),onChange:Pe,className:"basic-multi-select text-red ",classNamePrefix:"select"})})]})]}),n("ul",{className:"flex space-x-2 mt-5 border-b",children:G.filter(e=>e.role.includes(f.role_id)).map((e,t)=>m("li",{className:`cursor-pointer text-xs flex flex-row sm:text-base py-2 ${e.current===!0?"text-dark border-b-4  border-goldd font-bold ":"text-gray-400 "}`,onClick:()=>Ie(e.id),children:[n(e.icon,{className:"w-5 hidden sm:block"}),m("div",{className:"px-2",children:[" ",e.name]})]},t))}),R?m("div",{className:"min-h-screen md:pl-20 pt-16 h-full flex flex-col items-center justify-center",children:[m("div",{className:"flex items-center justify-center",children:[n("div",{className:"h-5 w-5 bg-goldd rounded-full mr-5 animate-bounce"}),n("div",{className:"h-5 w-5 bg-goldd rounded-full mr-5 animate-bounce200"}),n("div",{className:"h-5 w-5 bg-goldd rounded-full animate-bounce400"})]}),n("div",{className:"text-dark mt-4 font-bold",children:"Please wait while we get the data for you."})]}):m("div",{children:[" ",n(We,{originalData:ne,sortedData:b,setSortedData:M,currentUser:f,header:xe,setInvoiceDetails:te,body:b,POs:Z,states:D,selectedRecords:C,setSelectedRecords:w,supplierData:x,setPODetails:X,setPOBack:U,companies:I,categories:N,setInvoice:B,currentPage:le,setCurrentPage:_,setActiveIndexInv:E})]})]})}export{dt as default};
