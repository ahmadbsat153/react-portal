import{r as m,i as f,a as e,j as d}from"./app-e057de79.js";import i from"./InvoicesButton-7ea88f0c.js";import{c as K}from"./index-2fd36de9.js";import Q from"./PdfPreview-a5044247.js";import{h as n}from"./moment-fbc5633a.js";import"./_commonjs-dynamic-modules-302442b1.js";function se({setActiveIndexInv:g,setInvoiceDetails:X,invoiceDetails:a,AlertToast:s,states:x,url:N,getInvoices:I,supplierData:Y,companies:b,services:Z,categories:P,currentUser:l}){var v,C,B,k,T,_,j,H,D,E,R;const[z,$]=m.useState();f.get(`/findUserById/${a.AddedBy}`).then(r=>{$(r.data.user_name)});function G(){g(1)}m.useState(a.InvoicePic);function L(){if(l.role_id==6)return a.SecondApproval==2?!1:a.ApprovalStatus!=2;if(l.role_id==10)return a.SecondApproval!=2}const[p,V]=m.useState([]),S=async r=>{try{return(await f.get(`/findUserById/${r}`)).data.user_name}catch(t){return console.error("Error fetching user data:",t),"User not found"}};function M(){return l.role_id==10||l.role_id==1}m.useEffect(()=>{M()==!0&&(async()=>{try{const t={Model:1,MainId:a.InvoiceId},u=(await f.post(`${N}api/GTIS/Logs`,t,{headers:{UserId:l.user_id}})).data,J=await Promise.all(u.map(async o=>{const y={...o};return o.CreatedBy&&(y.CreatedBy=await S(o.CreatedBy)),o.Approval&&(y.Approval=await Promise.all(o.Approval.map(async c=>(c.ApprovedBy=await S(c.ApprovedBy),c)))),o.Payment&&(y.Payment=await Promise.all(o.Payment.map(async c=>(c.PaidBy=await S(c.PaidBy),c)))),y}));V(J)}catch(t){s("Error with showing logs.",2),console.log(t)}})()},[]);function q(){if(l.role_id==6){if(a.SecondApproval==1&&a.ApprovalStatus!=3)return a.PaymentStatus==!1,!0}else if(l.role_id==10){if(a.SecondApproval!=3)return!0}else return!1}function O(){return l.role_id==8?a.SecondApproval==2:!1}const[W,U]=m.useState(L()),[F,ee]=m.useState(O());function A(r){const t={InvoiceId:a.InvoiceId};f.post(`${N}api/GTIS/PayInvoice`,t,{headers:{UserId:l.user_id,Payment_Status:r}}).then(h=>{I(),r==1?s("Paid Successfully",1):s("Not Paid Successfully",1),g(1)}).catch(h=>{s("Error please try again.",2),console.log(h)})}function w(r){let t=0;l.role_id==10?t=2:t=1;const h={ApprovalModel:1,ApprovalType:t,MainId:a==null?void 0:a.InvoiceId,StatusId:r,AddedBy:l.user_id};f.post(`${N}api/GTIS/ApprovalStatus`,h,{headers:{UserId:l.user_id}}).then(u=>{I(),r==2?s("Approved Successfully",1):r==3&&s("Rejected Successfully",1),g(1)}).catch(u=>{s("Error please try again.",2),console.log(u)})}return e("div",{className:"bg-smooth",children:d("div",{className:"grid grid-cols-1 xl:grid-cols-2 p-5 gap-x-5 gap-y-5 ",children:[d("div",{className:"rounded-xl shadow bg-white p-5 ",children:[d("h1",{className:"font-bold text-dark text-3xl",children:["Invoice #"," ",e("span",{className:"text-goldd",children:a.InvoiceNo})]}),d("div",{className:"grid grid-cols-2 p-2 gap-y-3 pb-20 mt-5 text-sm sm:text-base",children:[" ",a.PoNb?d("div",{className:"col-span-2 grid grid-cols-2",children:[" ",e("h1",{className:"text-gray-400",children:"PO#:"}),e("p",{className:"font-bold",children:a.PoNb})]}):null,e("h1",{className:"text-gray-400",children:"Supplier:"}),e("p",{className:"font-bold",children:(v=Y==null?void 0:Y.find(r=>r.SupplierId===a.SupplierId))==null?void 0:v.SupplierName}),e("h1",{className:"text-gray-400",children:"Company:"}),e("p",{className:"font-bold",children:(C=b==null?void 0:b.find(r=>r.CompanyId===a.CompanyId))==null?void 0:C.CompanyName}),e("h1",{className:"text-gray-400",children:"Category:"}),e("p",{className:"font-bold",children:(B=P==null?void 0:P.find(r=>r.CategoryId===a.CategoryId))==null?void 0:B.CategoryName}),e("h1",{className:"text-gray-400",children:"State:"}),e("p",{className:"font-bold",children:(k=x==null?void 0:x.find(r=>r.StateId===a.StateId))==null?void 0:k.StateCode}),e("h1",{className:"text-gray-400",children:"Date:"}),e("p",{className:"font-bold",children:a.DueDate?n(a.DueDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY"):""}),e("h1",{className:"text-gray-400",children:"Due Date:"}),e("p",{className:"font-bold",children:a.DueDate?n(a.DueDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY"):""}),e("h1",{className:"text-gray-400",children:"Description:"}),e("p",{className:"font-bold",children:a.Description}),e("h1",{className:"text-gray-400",children:"Amount:"}),e("p",{className:"font-bold",children:a.Amount}),e("h1",{className:"text-gray-400",children:"Payment Type:"}),e("p",{className:"font-bold",children:a.PaymentTypeId===1?"Credit Card":a.PaymentTypeId===2?"Cash":""}),e("h1",{className:"text-gray-400",children:"Payment Bank:"}),e("p",{className:"font-bold",children:a.ProcessedBank}),e("h1",{className:"text-gray-400",children:"Payment Date:"}),e("p",{className:"font-bold",children:a.PaymentDate?n(a.PaymentDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY"):""}),e("h1",{className:"text-gray-400",children:"Invoice Date:"}),e("p",{className:"font-bold",children:a.InvoiceDate?n(a.InvoiceDate.replace("T"," "),"YYYY-MM-DD").format("DD-MM-YYYY"):""}),e("h1",{className:"text-gray-400",children:"POD Required:"}),e("p",{className:"font-bold",children:d("div",{children:[" ",a.PodRequired==!0?e("span",{className:"inline-flex items-center rounded-full bg-green-100 px-3 py-0.5 text-sm font-medium text-green-800",children:"true"}):e("span",{className:"inline-flex items-center rounded-full bg-red-100 px-3 py-0.5 text-sm font-medium text-red-800",children:"false"})]})}),e("h1",{className:"text-gray-400",children:"Status:"}),e("p",{className:"font-bold",children:d("div",{children:[" ",a.ApprovalStatus==1?e("span",{className:"inline-flex items-center rounded-full bg-gray-200 px-3 py-0.5 text-sm font-medium text-gray-800",children:"Waiting"}):a.ApprovalStatus==2?e("span",{className:"inline-flex items-center rounded-full bg-green-100 px-3 py-0.5 text-sm font-medium text-green-800",children:"Approved"}):e("span",{className:"inline-flex items-center rounded-full bg-red-100 px-3 py-0.5 text-sm font-medium text-red-800",children:"Rejected"})]})}),e("h1",{className:"text-gray-400",children:"Second approval:"}),d("p",{className:"font-bold",children:[" ",d("div",{children:[" ",a.SecondApproval==1?e("span",{className:"inline-flex items-center rounded-full bg-gray-200 px-3 py-0.5 text-sm font-medium text-gray-800",children:"Waiting"}):a.SecondApproval==2?e("span",{className:"inline-flex items-center rounded-full bg-green-100 px-3 py-0.5 text-sm font-medium text-green-800",children:"Approved"}):e("span",{className:"inline-flex items-center rounded-full bg-red-100 px-3 py-0.5 text-sm font-medium text-red-800",children:"Rejected"})]})]}),e("h1",{className:"text-gray-400",children:"Paid:"}),e("p",{className:"font-bold",children:d("div",{children:[" ",a.PaymentStatus==!0?e("span",{className:"inline-flex items-center rounded-full bg-green-100 px-3 py-0.5 text-sm font-medium text-green-800",children:"paid"}):e("span",{className:"inline-flex items-center rounded-full bg-red-100 px-3 py-0.5 text-sm font-medium text-red-800",children:"not paid"})]})}),e("h1",{className:"text-gray-400",children:"Created By:"}),e("p",{className:"font-bold",children:z})]}),d("div",{className:"flex justify-end w-full gap-x-2",children:[e(i,{name:"Back",onClick:()=>{G()},icon:e(K,{className:"mr-1 h-5"})}),d("div",{className:"",children:[" ",W?e("div",{className:"flex justify-end w-full gap-x-2",children:e(i,{name:"Approve",onClick:()=>{w(2)}})}):null]}),d("div",{className:"",children:[" ",q()?e("div",{className:"flex justify-end w-full gap-x-2",children:e(i,{name:"Reject",onClick:()=>{w(3)}})}):null]}),d("div",{className:"",children:[" ",F?e("div",{className:"flex justify-end w-full gap-x-2",children:(a==null?void 0:a.PaymentStatus)==!1?e(i,{name:"Pay",onClick:()=>{A(1)}}):e(i,{name:"Unpay",onClick:()=>{A(0)}})}):null]})]})]}),e("div",{className:"bg-white p-5 rounded-xl shadow",children:e("div",{children:e(Q,{pdfUrls:a.InvoiceDoc})})}),M()?d("div",{children:[" ",p?d("div",{className:"xl:col-span-2 bg-white rounded-xl shadow p-5",children:[d("div",{className:"font-bold py-2 border-b w-auto text-lg",children:["Created by ",(T=p[0])==null?void 0:T.CreatedBy," at"," ",n((_=p[0])==null?void 0:_.CreatedAt.replace("T"," "),"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD hh:mm:ss")=="Invalid date"?"":n((j=p[0])==null?void 0:j.CreatedAt.replace("T"," "),"YYYY-MM-DD hh:mm:ss").format("YYYY-MM-DD hh:mm:ss")]}),d("ol",{class:"relative border-l border-gray-200 dark:border-gray-700",children:[(D=(H=p[0])==null?void 0:H.Approval)==null?void 0:D.map(r=>d("li",{class:"mb-10 ml-4",children:[e("div",{class:"absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -left-1.5 border border-white dark:border-gray-900 dark:bg-gray-700"}),e("time",{class:"mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:n(r==null?void 0:r.ApprovedAt.replace("T"," "),"YYYY-MM-DD HH:mm:ss").format("YYYY-MM-DD HH:mm:a")=="Invalid date"?"":n(r==null?void 0:r.ApprovedAt.replace("T"," "),"YYYY-MM-DD HH:mm:ss").format("YYYY-MM-DD HH:mm:a")}),d("h3",{class:"text-lg font-semibold text-gray-900",children:[r.ApprovedBy," has"," ",r.ApprovalStatus==2?"approved":"rejected"," ","this invoice"]})]})),(R=(E=p[0])==null?void 0:E.Payment)==null?void 0:R.map(r=>d("li",{class:"mb-10 ml-4",children:[e("div",{class:"absolute w-3 h-3 bg-gray-200 rounded-full mt-1.5 -left-1.5 border border-white dark:border-gray-900 dark:bg-gray-700"}),e("time",{class:"mb-1 text-sm font-normal leading-none text-gray-400 dark:text-gray-500",children:n(r.PaidAt.replace("T"," "),"YYYY-MM-DD HH:mm:ss").format("YYYY-MM-DD HH:mm:a")}),d("h3",{class:"text-lg font-semibold text-gray-900",children:[r.PaidBy," has"," ",r.PaymentStatus==1?"paid":"unpaid"," ","this invoice"]})]}))]})]}):null," "]}):null]})})}export{se as default};
